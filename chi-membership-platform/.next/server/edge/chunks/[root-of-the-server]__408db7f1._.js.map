{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/membership-platform/middleware.ts"],"sourcesContent":["// middleware.ts\r\n\r\nimport { withAuth } from \"next-auth/middleware\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport default withAuth(\r\n  function middleware(req) {\r\n    const token = req.nextauth.token;\r\n    const isAuth = !!token;\r\n    const isAuthPage = req.nextUrl.pathname.startsWith(\"/auth\");\r\n    const isPublicPage = \r\n      req.nextUrl.pathname === \"/\" || \r\n      req.nextUrl.pathname === \"/pricing\" ||\r\n      req.nextUrl.pathname === \"/about\" ||\r\n      req.nextUrl.pathname === \"/terms\" ||\r\n      req.nextUrl.pathname === \"/privacy\";\r\n\r\n    // Redirect authenticated users away from auth pages\r\n    if (isAuthPage && isAuth) {\r\n      return NextResponse.redirect(new URL(\"/dashboard\", req.url));\r\n    }\r\n\r\n    // Allow access to public pages\r\n    if (isPublicPage) {\r\n      return NextResponse.next();\r\n    }\r\n\r\n    // Check subscription status for premium features\r\n    const isPremiumFeature = \r\n      req.nextUrl.pathname.startsWith(\"/courses/advanced\") ||\r\n      req.nextUrl.pathname.startsWith(\"/coaching\") ||\r\n      req.nextUrl.pathname.startsWith(\"/analytics/advanced\");\r\n\r\n    if (isPremiumFeature && token?.subscriptionTier === \"FREE\") {\r\n      return NextResponse.redirect(new URL(\"/pricing?upgrade=true\", req.url));\r\n    }\r\n\r\n    // Check onboarding status\r\n    if (\r\n      token?.onboardingStatus === \"NOT_STARTED\" &&\r\n      !req.nextUrl.pathname.startsWith(\"/onboarding\") &&\r\n      !isAuthPage &&\r\n      !isPublicPage\r\n    ) {\r\n      return NextResponse.redirect(new URL(\"/onboarding\", req.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n  },\r\n  {\r\n    callbacks: {\r\n      authorized: ({ token, req }) => {\r\n        const isAuthPage = req.nextUrl.pathname.startsWith(\"/auth\");\r\n        const isPublicPage = \r\n          req.nextUrl.pathname === \"/\" || \r\n          req.nextUrl.pathname === \"/pricing\" ||\r\n          req.nextUrl.pathname === \"/about\" ||\r\n          req.nextUrl.pathname === \"/terms\" ||\r\n          req.nextUrl.pathname === \"/privacy\";\r\n\r\n        // Allow access to auth and public pages without token\r\n        if (isAuthPage || isPublicPage) {\r\n          return true;\r\n        }\r\n\r\n        // Require token for all other pages\r\n        return !!token;\r\n      },\r\n    },\r\n  }\r\n);\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - api/auth (auth endpoints)\r\n     * - api/webhooks (webhook endpoints)\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - public folder\r\n     */\r\n    \"/((?!api/auth|api/webhooks|_next/static|_next/image|favicon.ico|public).*)\",\r\n  ],\r\n};"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;AAEhB;AACA;AAAA;;;uCAEe,IAAA,wLAAQ,EACrB,SAAS,WAAW,GAAG;IACrB,MAAM,QAAQ,IAAI,QAAQ,CAAC,KAAK;IAChC,MAAM,SAAS,CAAC,CAAC;IACjB,MAAM,aAAa,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IACnD,MAAM,eACJ,IAAI,OAAO,CAAC,QAAQ,KAAK,OACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,cACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,YACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,YACzB,IAAI,OAAO,CAAC,QAAQ,KAAK;IAE3B,oDAAoD;IACpD,IAAI,cAAc,QAAQ;QACxB,OAAO,2PAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,IAAI,GAAG;IAC5D;IAEA,+BAA+B;IAC/B,IAAI,cAAc;QAChB,OAAO,2PAAY,CAAC,IAAI;IAC1B;IAEA,iDAAiD;IACjD,MAAM,mBACJ,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,wBAChC,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,gBAChC,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAElC,IAAI,oBAAoB,OAAO,qBAAqB,QAAQ;QAC1D,OAAO,2PAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,IAAI,GAAG;IACvE;IAEA,0BAA0B;IAC1B,IACE,OAAO,qBAAqB,iBAC5B,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,kBACjC,CAAC,cACD,CAAC,cACD;QACA,OAAO,2PAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,IAAI,GAAG;IAC7D;IAEA,OAAO,2PAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE;YACzB,MAAM,aAAa,IAAI,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;YACnD,MAAM,eACJ,IAAI,OAAO,CAAC,QAAQ,KAAK,OACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,cACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,YACzB,IAAI,OAAO,CAAC,QAAQ,KAAK,YACzB,IAAI,OAAO,CAAC,QAAQ,KAAK;YAE3B,sDAAsD;YACtD,IAAI,cAAc,cAAc;gBAC9B,OAAO;YACT;YAEA,oCAAoC;YACpC,OAAO,CAAC,CAAC;QACX;IACF;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;;KAQC,GACD;KACD;AACH"}}]
}